\chapter{\texorpdfstring{$\ell$}{ℓ}-adic representations attached to elliptic
curves}\label{ch:iv}
\chaptermark{Elliptic curves}

Let $K$ be a number field and let $E$ be an elliptic curve over $K$.
\dpage
If $\ell$ is a prime number, let
\[
	\rho_\ell \colon \Gal(\algcl K/K) \longrightarrow \Aut(V_\ell(E))
\]
be the corresponding $\ell$-adic representation of $K$, cf.\ chap.~\ref{ch:i},
\ref{sec:I_12}.  The main result of this Chapter is the determination of the
Lie algebra of the $\ell$-adic Lie group $G_\ell = \Img(\rho_\ell)$. This is
based on a finiteness theorem of \v Safarevi\v c (\ref{sec:IV_14}) combined
with the properties of locally algebraic abelian representations
(chap.~\ref{ch:iii}) and Tate's local theory of elliptic curves with
non-integral modular invariant (Appendix, \ref{sec:IV_A1}). The variation of
$G_\ell$ with $\ell$ is studied in \S\ref{sec:IV_3}.

The Appendix gives analogous results in the local case (i.e.\ when $K$ is a
local field).

\section{Preliminaries}\dpage
\subsection[Elliptic curves]{Elliptic curves \textmd{(cf.\
\citeauthor{5}~\cite{5}, \citeauthor{9}~\cite{9}, \citeauthor{10}~\cite{10})}}
By an elliptic curve, we mean an abelian variety of dimension
1, i.e.\ a complete, non singular, connected curve of genus 1 with a
given rational point $P_0$, taken as an origin for the composition law
(and often written $o$).

Let $E$ be such a curve. It is well known that $E$ may be embedded, as a
non-singular cubic, in the projective plane $\PP^2_K$, in such a way that $P_0$
becomes a \textquote{flex} (one takes the projective embedding defined by the
complete linear series containing the divisor $3\cdot P_0$). In this embedding,
three points $P_1$, $P_2$, $P_3$ have sum $0$ if and only if the divisor $P_1 +
P_2 + P_3$ is the intersection of $E$ with a line. By choosing a suitable
coordinate system, the equation of $E$ can be written in Weierstrass form
\[
	y^2 = 4x^3 - g_2x - g_3
\]
where $x$, $y$ are non-homogeneous coordinates and the origin $P_0$ is
the point at infinity on the $y$-axis. The discriminant
\[
	\Delta = g_2^3 - 27g_3^2
\]
is non-zero.

The coefficients $g_2$, $g_3$ are determined up to the transformations $g_2
\mapsto u^4 g_2$, $g_3 \mapsto u^6 g_3$, $u \in K^\times$. The modular
invariant $j$ of $E$ is
\[
	j = 2^6 \, 3^3 \, \frac{g_2^3}{g_2^3 - 27g_3^2}
	= 2^6 \, 3^3 \, \frac{g_2^3}{\Delta}.
\]
\dpage
Two elliptic curves have the same $j$ invariant if and only if they become
isomorphic over the algebraic closure of $K$.

(All this remains valid over an arbitrary field, except that, when the
characteristic is 2 or 3, the equation of $E$ has to be written in the more
general form
\[
	y^2 + a_1xy + a_3y + x^3 + a_2x^2 + a_4x + a_6 = 0.
\]
Here again, 0 is the point at infinity on the $y$-axis and the 
corresponding tangent is the line at infinity. There are corresponding
definitions for $\Delta$ and $j$, for which we refer to \citeauthor{9}~\cite{9}
or \citeauthor{20}~\cite{20}; note, however, that there is a misprint in Ogg's
formula for $\Delta$: the coefficient of $\beta_4^3$ should be $-8$ instead of
$-1$.)

\subsection{Good reduction}
\label{sec:IV_12}
Let $v \in M_K^0$ be a finite place of the number field $K$. We denote by
$\mathcal{O}_v$ (resp.\ $\mathfrak{m}_v$, $k_v$) the corresponding local ring
in $K$ (resp.\ its maximal ideal, its residue field).

Let $E$ be an elliptic curve over $K$. One says that $E$ has \strong{good
reduction at $v$} if one can find a coordinate system in $\PP^2_K$ such that
the corresponding equation $f$ for $E$ has coefficient in $\mathcal{O}_v$ and
its reduction $\tilde f \mod{\mathfrak{m}_v}$ defines a non-singular cubic
$\widetilde{E}_v$ (hence an elliptic curve) over the residue field $k_v$ (in
other words, the discriminant $\Delta(f)$ of $f$ must be an invertible element
of $\mathcal{O}_v$).
The curve $\widetilde{E}_v$ is called the \strong{reduction} of $E$ at $v$;
\dpage
it does not depend on the choice of $f$, provided, of course, that $\Delta(f) \in
\mathcal{O}_v^\times$.

One can prove that the above definition is equivalent to the following one:
there is an abelian scheme $E_v$ over $\Spec(\mathcal{O}_v)$, in the sense of
\citeauthor{19}~\cite{19}, chap.\ VI, whose generic fiber is $E$; this scheme
is then unique, and its special fiber is $\widetilde{E}_v$. Note that
$\widetilde{E}_v$ is defined over the finite field $k_v$; we denote its
\strong{Frobenius endomorphism} by $F_v$.

On either definition, one sees that $E$ has \strong{good reduction for
almost all places of $K$}.

If $E$ has good reduction at a given place $v$, its $j$ invariant is
\strong{integral at $v$} (i.e.\ belongs to $\mathcal{O}_v$) and its reduction
$\tilde\jmath \mod{\mathfrak{m}_v}$ is the $j$ invariant of the reduced curve
$\widetilde{E}_v$.

The converse is almost true, but not quite: if $j$ belongs to $\mathcal{O}_v$,
there is a finite extension $L$ of $K$ such that $E \otimes_K L$ has good
reduction at all the places of $L$ dividing $v$ (this is the ``potential good
reduction'' of \citeauthor{32}~\cite{32}, \S 2). For the proof of this, see
\citeauthor{29}~\cite{29}, \S 4, n\textsuperscript{o}~3.

\begin{obs}
The definitions and results of this section have nothing to do with number
fields. They apply to every field with a discrete valuation.
\end{obs}

\subsection{Properties of \texorpdfstring{$V_\ell$}{Vℓ} related to good
reduction}\label{sec:IV_13}
Let $\ell$ be a prime number. We define, as in chap.~\ref{ch:i},
\ref{sec:I_12}, the Galois modules $T_\ell$ and $V_\ell$ by:
\[
	V_\ell = T_\ell \otimes \Q_\ell, \qquad T_\ell = \invlim_n E_{\ell^n}
\]
where $E_{\ell^n}$ is the kernel of $\ell^n \colon E(\algcl K) \to E(\algcl K)$.
\dpage

We denote by $\rho_\ell$ the corresponding homomorphism of $\Gal(\algcl K/K)$
into $\Aut(T_\ell)$. Recall that $E_{\ell^n}$, $T_\ell$ and $V_\ell$ are of
rank 2 over $\Z/\ell^n\Z$, $\Z_\ell$ and $\Q_\ell$, respectively.

Let now $v$ be a place of $K$, with $p_v \ne \ell$ and let $v$ be some
extension of $v$ to $\algcl K$; let $D$ (resp.\ $I$) be the corresponding
decomposition group (resp.\ inertia group), cf.\ chap.~\ref{ch:i},
\ref{sec:I_21}. If $E$ has good reduction at $v$, one easily sees that
reduction at $v$ defines an \emph{isomorphism} of $E_{\ell^n}$ onto the
corresponding module for the reduced curve $\widetilde{E}_v$. In particular,
$E_{\ell^n}$, $T_\ell$, $V_\ell$ are \emph{unramified at $v$}
(chap.~\ref{ch:i}, \ref{sec:I_21}) and the Frobenius automorphism $F_{v,
\rho_\ell}$ of $T_\ell$ corresponds to the Frobenius endomorphism $F_v$ of
$\widetilde{E}_v$. Hence: 
\[
	\det(F_{v, \rho_\ell}) = \det(F_v) = \numnorm v
\]
and
\[
	\det(1 - F_{v, \rho_\ell}) = \det(1 - F_v) = 1 - \tr(F_v) + \numnorm v
\]
is equal to the number of $k_v$-points of $\widetilde{E}_v$.

Conversely:
\begin{thm}[Criterion of Néron-Ogg-\v Safarevi\v c]
If $V$ is unramified at $v$ for some $\ell \ne p_v$, then $E$ has good
reduction at $v$.
\end{thm}
For the proof, see \citeauthor{32}~\cite{32}, \S 1.

\begin{cor}
Let $E$ and $E'$ be two elliptic curves which are isogenous (over $K$). If one
of them has good reduction at a place $v$, the same is true for the other one.
\end{cor}
(Recall that $E$ and $E'$ are said to be \strong{isogenous} if there
\dpage
exists a non-trivial morphism $E \to E'$.)

This follows from the theorem, since the $\ell$-adic representations associated
with $E$ and $E'$ are isomorphic.

\begin{obs}
For a direct proof of this corollary, see \citeauthor{11}~\cite{11}.
\end{obs}

\subsubsection*{Exercise}
Let $S$ be the finite set of places where $E$ does not have good reduction. If
$v \in M_K^0 \setminus S$, we denote by $t_v$ the number of $k_v$-points of the
reduced curve $\widetilde{E}_v$.
\begin{enumerate}[(a)]
	\item Let $\ell$ be a prime number and let $m$ be a positive integer.
		Show that the following properties are equivalent:
	\begin{enumerate}[(i)]
		\item\label{exr:cebotarev_i}
			$t_v \equiv 0 \mod{\ell^m}$ for all $v \in M_K^0 \setminus S$, $p_v \ne \ell$.
		\item\label{exr:cebotarev_ii}
			The set of $v \in M_K^0 \setminus S$ such that $t_v
			\equiv 0 \mod{\ell^m}$ has density one (cf.\ 
			chap.~\ref{ch:i}, 2.2).
		\item\label{exr:cebotarev_iii}
			For all $s \in \Img(\rho)$, one has $\det(1-s) \equiv 0 \mod{\ell^m}$.
	\end{enumerate}
	(The equivalence of \ref{exr:cebotarev_ii} and \ref{exr:cebotarev_iii}
	follows from \v Cebotarev's density theorem. The implications
	\ref{exr:cebotarev_i} $\implies$ \ref{exr:cebotarev_ii} and
	\ref{exr:cebotarev_iii} $\implies$ \ref{exr:cebotarev_i} are easy.)

	\item We take now $m = 1$. Show that the properties
		\ref{exr:cebotarev_i}, \ref{exr:cebotarev_ii} and
		\ref{exr:cebotarev_iii} are equivalent to:
	\begin{enumerate}[resume*]
		\item\label{exr:cebotarev_iv}
			There exists an elliptic curve $E'$ over $K$ such that:
		\begin{itemize}
			\item[$(\alpha)$]
				Either $E'$ is isomorphic to $E$, or there
				exist an isogeny $E' \to E$ of degree $\ell$.
			\item[$(\beta)$]
				The group $E'(K)$ contains an element of order
				$\ell$.
		\end{itemize}
	\end{enumerate}
	(The implication \ref{exr:cebotarev_iv} $\implies$
	\ref{exr:cebotarev_iii} is easy. For the proof of the converse, use
	Exer.~\ref{ex:I11_ex2} of chap.~\ref{ch:i}, \ref{sec:I_11}.)
	[For $m > 2$, see \citeauthor{64}~\cite{64}.]
\end{enumerate}

\subsection{\v Safarevi\v c's theorem}%
\label{sec:IV_14}
\dpage
It is the following (cf.\ \cite{23}):
\begin{thm}
Let $S$ be a finite set of places of $K$. The set of isomorphism classes of
elliptic curves over $K$, with good reduction at all places not in $S$, is
finite.
\end{thm}
Since isogenous curves have the same bad reduction set (cf.\ \ref{sec:IV_13}),
this implies:
\begin{cor}
Let $E$ be an elliptic curve over $K$. Then, up to isomorphism, there are only
a finite number of elliptic curves which are $K$-isogenous to $E$.
\end{cor}

To prove the theorem, we use the following criterion for good reduction:
\begin{lem}
Let $S$ be a finite set of places of $K$ containing the divisors of 2 and 3,
and such that the ring $\mathcal{O}_S$ of $S$-integers is principal. Then, an
elliptic curve $E$ defined over $K$ has good reduction outside $S$ if and only
if its equation can be put in the Weierstrass form $y^2 = 4x^3 - g_2 x - g_3$
with $g_i \in \mathcal{O}_S$ and $\Delta = g_2^3 - 27 g_2^3 \in
\mathcal{O}_S^\times$ (the group of units of $\mathcal{O}_S$).
\end{lem}

\begin{proof}
The sufficiency is trivial. To prove necessity, we write the
curve $E$ in the form
\begin{equation}
	y^2 = 4x^3 - g_2^\prime x - g_3^\prime
	\tag{$*$}
	\label{eq:safarevich_lemma}
\end{equation}
with $g_i^\prime \in K$. Let $v$ be a place of $K$ not in $S$. Then, since
there is good reduction at $v$, and since the divisors of 2 and 3 do not belong
\dpage
to $S$, the curve $E$ can be written in the form
\[
	y^2 = 4x^3 - g_{2, v}^\prime x - g_{3, v}^\prime
\]
with $g_{i, v}$ in the local ring at $v$ and the discriminant $\Delta_v$ a unit
in this ring. Using the properties of the Weierstrass form, there is an element
$u_v \in K$ such that $g_{2, v} = u_v^4 g^\prime_2$, $g_{3, v} = u_v^6
g^\prime_3$, $\Delta_v = u_v^{12} \Delta'$;\label{errata:uv12} moreover, as we
can take $g_{i,v} = g_i^\prime$ for almost all $v$, we see that we can assume
that $u_v = 1$ for almost all $v \notin S$. Since the ring $\mathcal{O}_S$ is
principal, there is an element $u \in K^\times$ with $v(u) = v(u_v)$ for all $v
\notin S$. Then, if we replace $x$ by $u^{-2} x$ and $y$ by $u^{-3} y$ in
\eqref{eq:safarevich_lemma}, the curve $E$ takes the form
\[
	y^2 = 4x^3 - g_2^\prime x - g_3^\prime
\]
with $g_2 = u^4 g^\prime_2$, $g_3 = u^6 g^\prime_3$ and $\Delta = u^{12}
\Delta'$. Since, by construction, $g_i \in \mathcal{O}_S$ and $\Delta \in
\mathcal{O}_S^\times$ the lemma is established.
\end{proof}

\begin{proof}[ of the theorem]
After possibly adding a finite number of places of $K$ to $S$, we may assume
that $S$ contains all the divisors of 2 and 3, and that the ring
$\mathcal{O}_S$ is principal. If $E$ is an elliptic curve defined over $K$
having good reduction outside $S$, the above lemma tells us that we can write
$E$ in the form
\begin{equation}
	y^2 = 4x^3 - g_2^\prime x - g_3^\prime
	\tag{$*$}
	\label{eq:wei_form_star2}
\end{equation}
with $g_i \in \mathcal{O}_S$ and $\Delta = g_2^3 - 27 g_2^3 \in \mathcal{O}_S$.
But, since we are free to multiply $\Delta$ by any $u \in
{(\mathcal{O}_S^\times)}^{12}$, and since
$\mathcal{O}_S^\times/{(\mathcal{O}_S^\times)}^{12}$ is a finite group, we see
that there is a finite set $X \subset \mathcal{O}_S^\times$ such that any
elliptic
\dpage
curve of the above type can be written in the form \eqref{eq:wei_form_star2}
with $g_i \in \mathcal{O}_S$ and $\Delta \in X$. But, for a given $\Delta$, the
equation
\[
	U^3 - 27V^2 = \Delta
\]
represents an affine elliptic curve. Using a theorem of Siegel (generalized by
Mahler and Lang, cf.\ \citeauthor{14}~\cite{14}, chap.~VII), one sees that this
equation has only a \emph{finite} number of solutions in $\mathcal{O}_S$. This
finishes the proof of the theorem.
\end{proof}

\begin{obs}
There are many ways in which one can deduce \v Safarevi\v c's theorem from
Siegel's. The one we followed has been shown to us by Tate.
\end{obs}

\section{The Galois module attached to $E$}
In this section, $E$ denotes an elliptic curve over $K$. We are
interested in the structure of the Galois modules $E_{\ell^n}$, $T_\ell$, $V_\ell$
defined in \ref{sec:IV_13}.

\subsection{The irreducibility theorem}
\label{sec:IV_21}
Recall first that the ring $\End_K(E)$ of $K$-endomorphisms of $E$
is either $\Z$ or of rank 2 over $\Z$. In the first case, we say that $E$
has ``no complex multiplication over $K$.'' If the same is true for any
finite extension of $K$, we say that $E$ has ``no complex 
multiplication.''

\begin{thm}
Assume that $E$ has no complex multiplication over $K$.
\dpage
Then:
\begin{enumerate}[(a)]
\item\label{thm:IV_21_a} $V_\ell$ is irreducible for all primes $\ell$;
\item $E_\ell$ is irreducible for almost all primes $\ell$.
\end{enumerate}
\end{thm}

We need the following elementary result:
\begin{lem}
Let $E$ be an elliptic curve defined over $K$ with $\End_K(E) = \Z$. Then, if
$E' \to E$, $E'' \to E$ are $K$-isogenies with non-isomorphic cyclic kernels,
the curves $E'$ and $E''$ are non-isomorphic over $K$.
\end{lem}
\begin{proof}
Let $n'$ and $n''$ be respectively the orders of the kernels of
$E' \to E$ and $E'' \to E$. Suppose that $E'$ and $E''$ are isomorphic
over $K$, and let $E' \to E''$ be an isomorphism. If $E \to E'$ is the
transpose of the isogeny $E' \to E$, it has a cyclic kernel of order
$n'$, and hence the isogeny $E \to E$, obtained by composition of
$E \to E'$, $E' \to E''$, $E'' \to E$, has for kernel an extension of
$\Z/n''\Z$ by $\Z/n'\Z$. But, since $\End_K(E) = \Z$, this isogeny must be
multiplication by an integer $a$, and its kernel must therefore be of
the form $\Z/a\Z \times \Z/a\Z$. Hence $n'$ and $n''$ divide $a$. Since
$a^2 = n'n''$, we obtain $a = n' = n''$, a contradiction.
\end{proof}

\begin{proof}[ of the theorem]
\begin{enumerate}[(a)]
\item It suffices to show that, if $\End_K(E) = \Z$, there is no
	one-dimensional $\Q_\ell$-subspace of $V_\ell$ stable under
	$\Gal(\algcl K/K)$. Suppose there were one; its intersection $X$ with
	$T_\ell$ would be a submodule of $T_\ell$ with $X$ and $T_\ell/X$ free
	$Z_\ell$-modules of rank 1. For $n \ge 0$, consider the image $X(n)$ of
	$X$ in $E_{\ell^n} = T/\ell^n T$. This is a submodule of $E_\ell$ which
	is cyclic of order $\ell^n$ and stable by $\Gal(\algcl K/K)$. Hence it
	corresponds to a finite $K$-algebraic subgroup of
	\dpage
	$E$ and one can define the quotient curve $E(n) = E/X(n)$. The kernel
	of the isogeny $E \to E(n)$ is cyclic of order $\ell^n$. The above
	lemma then shows that the curves $E(n)$, $n \ge 0$, are pairwise
	non-isomorphic, contradicting the corollary to \v Safarevi\v c's
	theorem (\ref{sec:IV_14}).
\item If $E$ is not irreducible, there exists a Galois submodule $X$ of $E$
	which is one-dimensional over $\F_\ell$. In the same way as above, this
	defines an isogeny $E \to E/X_\ell$ whose kernel is cyclic of order
	$\ell$. The above lemma shows that the curves which correspond to
	different values of $\ell$ are\break non-isomorphic, and one again applies
	the corollary to \v Safarevi\v c's\break theorem.
	\qedhere
\end{enumerate}
\end{proof}

\begin{obs}
One can prove part \ref{thm:IV_21_a} of the above theorem by a quite different
method (cf.\ \cite{25}, \S 3.4); instead of the \v Safarevi\v c's theorem, one
uses the properties of the decomposition and inertia subgroups of
$\Img(\rho_\ell)$, cf.\ Appendix.
\end{obs}

\subsection{Determination of the Lie algebra of \texorpdfstring{$G_\ell$}{Gℓ}}
\label{sec:IV_22}
Let $G_\ell = \Img(\rho_\ell)$\index{Gl@$G_\ell$} denote the image of $\Gal(\algcl K/K)$ in
$\Aut(T_\ell)$, and let $\mathfrak{g}_\ell \subset \End(V_\ell)$ be the Lie
algebra of $G_\ell$.

\begin{thm}
	If $E$ has no complex multiplication (cf.\ \ref{sec:IV_21}), then
	$\mathfrak{g}_\ell = \End(V_\ell)$, i.e.\ $G_\ell$ is open in
	$\Aut(T_\ell)$.
\end{thm}
\begin{proof}
	The irreducibility theorem of \ref{sec:IV_21} shows that, for any open
	subgroup $U$ of $G_\ell$, $V_\ell$ is an irreducible $U$-module. Hence,
	$V_\ell$ is an irreducible $\mathfrak{g}_\ell$-module. By Schur's
	lemma, it follows that the commuting algebra $\mathfrak{g}^\prime_\ell$
	of $\mathfrak{g}_\ell$ in $\End(V_\ell)$ is a field; since $\dim V_\ell
	= 2$, this field is either $\Q_\ell$ or a quadratic extension of
	$\Q_\ell$.  If $\mathfrak{g}^\prime_\ell = \Q_\ell$, then
	$\mathfrak{g}_\ell$ is equal to either $\End(V_\ell)$, or the
	subalgebra $\Sl(V_\ell)$
	\dpage
	\todo[pinktask]{Revisar si $\Sl(V)$ es la notación adecuada.}
	of $\End(V_\ell)$ consisting of the endomorphisms with trace 0; but, in
	the second case, the action of $\mathfrak{g}_\ell$ on $\bigwedge^2
	V_\ell$ would be trivial, and this would contradict the fact that the
	Galois modules $\bigwedge^2 V_\ell$ and $V_\ell(\mu)$ are isomorphic
	(chap.~\ref{ch:i}, \ref{sec:I_12}). Hence $\mathfrak{g}_\ell =
	\Sl(V_\ell)$ is impossible.

	Suppose now that $\mathfrak{g}_\ell^\prime$ is a quadratic extension of
	$\Q_p$. Then $V_\ell$ is a one-dimensional
	$\mathfrak{g}_\ell^\prime$-vector space and the commuting algebra of
	$\mathfrak{g}_\ell^\prime$ in $\End(V_\ell)$ is
	$\mathfrak{g}_\ell^\prime$ itself. Hence $\mathfrak{g}_\ell$ is
	contained in $\mathfrak{g}_\ell^\prime$, and is \emph{abelian}
	($\mathfrak{g}_\ell^\prime$ is a ``non-split Cartan algebra'' of
	$\End(V_\ell)$).  After replacing $K$ by a finite extension (this does
	not affect $\mathfrak{g}_\ell$, cf.\ chap.~\ref{ch:i}, \ref{sec:I_11}),
	we may then suppose that $G_\ell$ itself is abelian. The $\ell$-adic
	representation $V_\ell$ is then semi-simple, abelian and rational.  It
	is, moreover, \emph{locally algebraic}. To see this, we first remark
	that, at a place $v$ dividing $\ell$, we have $v(j) \ge 0$ since
	otherwise the decomposition group of $v$ in $G_\ell$ would be
	non-abelian by Tate's theory (cf.\ Appendix, \ref{sec:IV_A13}); hence,
	after a finite extension of $K$, we can assume that $E$ has good
	reduction at all places $v$ dividing $\ell$ (cf.\ \ref{sec:IV_12}). Let
	$E(\ell)$ be the $\ell$-divisible group attached to $E$ at $v$ (cf.\ 
	\citeauthor{39}~\cite{39}, 2.1, example~(a)). We have $V_\ell \cong
	V_\ell(E(\ell))$ and this module is known to be of Hodge-Tate type
	(\emph{loc. cit.}, \S 4). Using another result of Tate
	(chap.~\ref{ch:iii}, \ref{sec:III_12}), this implies that the
	representation $V_\ell$ is locally algebraic, as claimed above. (This
	could also be seen by using, instead of the theory of Hodge-Tate
	modules, the local results of the Appendix, \ref{sec:IV_A2}.)

	We may now apply to $V_\ell$ the results of chap.~\ref{ch:iii},
	\ref{sec:III_23}.  Hence, there is, for each prime $\ell'$, a rational,
	abelian, semi-simple $\ell'$-adic representation $W_{\ell'}$ compatible
	with $V_\ell$. But $V_{\ell'}$ is compatible with $V_\ell$, and
	$V_{\ell'}$ is semi-simple. Hence $V_{\ell'}$, is isomorphic to
	$W_{\ell'}$ (cf.\ chap.~\ref{ch:i}, \ref{sec:I_23}). But we know
	(chap.~\ref{ch:iii}, \ref{sec:III_23}) that we may choose $\ell'$ such
	\dpage
	that $W_{\ell'}$ is the direct sum of one-dimensional subspaces stable
	under $\Gal(\algcl K/K)$. This contradicts the irreducibility of
	$V_\ell$. Hence, we must have $\mathfrak{g}_\ell^\prime = \Q_p$ and
	$\mathfrak{g}_\ell = \End(V_\ell)$.
\end{proof}

\begin{obs}
	If $E$ has complex multiplication, and $L = \Q \otimes \End(E \otimes_K
	\algcl K)$ is the corresponding imaginary quadratic field, one shows
	easily that $\mathfrak{g}_\ell$ is the Cartan subalgebra of
	$\End(V_\ell)$ defined by $L_\ell = \Q_\ell \otimes L$. It splits if and
	only if $\ell$ decomposes in $L$.
\end{obs}

\subsubsection*{Exercises}
(In these exercises, we assume $E$ has no complex multiplication. Let $S$ be
the set of places $v \in M_K^0$ where $E$ has bad reduction. If $v \in M_K^0
\setminus S$, we denote by $F_v$ the Frobenius endomorphism of the reduced
curve $\widetilde{E}_v$; if $\ell \ne p_v$, we identify $F_v$ to the
corresponding automorphism of $T_\ell$.)

\begin{enumerate}
\item Let $H(X, Y)$ be a polynomial in two indeterminates $X$, $Y$ with
	coefficients in a field of characteristic zero. Let $V_H$ be the set of
	those $v \in M_K^0 \setminus S$ for which $H(\Tr(F_v), \numnorm v) =
	0$. If $H$ is not the zero polynomial, show that $V_H$ has density 0.
	(Show that the set of $g \in \GL(2, \Z_\ell)$ with $H(\Tr(g), \det(g)) =
	0$ has Haar measure zero.)

\item The eigenvalues of $F_v$ may be identified with complex numbers of the
	form
	\[
		(\numnorm v)^{1/2} e^{\pm i \varphi_v},
		\qquad 0 \le \varphi_v \le \pi,
	\]
	cf.\ chap.~\ref{ch:i}, Appendix~\ref{sec:I_A2}. Show that the set of
	$v$ for which $\varphi_v$ is a given angle $\varphi$ has density zero.
	(Show that $\Tr(F_v)^2 = 4(\numnorm v)\cos^2 \varphi$ and then use the
	preceding exercise.)

\item Let $L_v = \Q(F_v)$ be the field generated by $F_v$. By the preceding
	\dpage
	exercise, $L_v$ is quadratic imaginary except for a set of $v$ of
	density 0.
	\begin{enumerate}
	\item\label{ex:IV_22_3a} Let $\ell$ be a fixed prime. Let $C$ be a semi-simple commutative
		$\Q_\ell$-algebra of rank 2. Let $X_C$ be the set of elements
		$s \in \Aut(V_\ell)$ such that the subalgebra $\Q_\ell[s]$ of
		$\End(V_\ell)$ generated by $s$ is isomorphic to $C$. Show that
		$X_C$ is open in $\Aut(V_\ell)$, and show that it has a
		non-empty intersection with every open subgroup of
		$Aut(V_\ell)$, in particular, with $G_\ell$.
	\item Show that $F_v \in X_C$ if and only if the field $L_v$ is
		quadratic and $L_v \otimes \Q_\ell$ is isomorphic to $C$.
	\item Let $\ell_1, \dots, \ell_n$ be distinct prime numbers, and choose
		for each an algebra $C_i$ of the type considered in
		\ref{ex:IV_22_3a}. Show that the set of $v$ for which $F_v \in
		X_C$ for $i = 1, \dots, n$ has density $> 0$.

		(Use the fact that the image of $\Gal(\algcl K/K)$ in any
		finite product of the $\Aut(V_\ell)$ is open; this is an easy
		consequence of the theorem proved above.)
	\item Deduce that, for any finite set $P$ of prime numbers, there exist
		an infinity of $v$ such that $L_v$ is ramified at all $\ell \in
		P$. In particular, there are an infinite number of distinct
		fields $L_v$.
	\end{enumerate}
\end{enumerate}

\subsection{The isogeny theorem}
\label{sec:IV_23}
\todo[section]{Belen.}

\section{Variation of \texorpdfstring{$G_\ell$}{Gℓ} and
\texorpdfstring{$\widetilde{G}_\ell$}{Ḡℓ} with \texorpdfstring{$\ell$}{ℓ}}

\subsection{Preliminaries}
\label{sec:IV_31}
\todo[section]{Belen.}

\subsection{The case of a non integral $j$}
\label{sec:IV_32}
\dpage
\begin{thm}
	Assume that the modular invariant $j$ of $E$ is not an integer of $K$.
	Then $E$ enjoys the equivalent properties (i), (ii), (iii), (iv) of
	\ref{sec:IV_31}.
\end{thm}
Since $j$ is not integral, we can choose a place $v$ of $K$ such
that $v(j) < 0$. Let $q$ be the element of the local field $K$ which
corresponds to $j$ by Tate's theory (cf.\ Appendix, \ref{sec:IV_A11}) and let $E$
be the corresponding elliptic curve over $K$. There is a finite
extension $K'$ of $K_v$ over which $E$ and $E_q$ are isomorphic; one
can even take for $K'$ either $K_v$ or a quadratic extension of $K_v$.
Let $v'$ be the valuation of $K'$ which extends $v$; assume $v'$ is
normalized so that $v'({K'}^\times) = \Z$, and let
\[
	n = v'(q) = - v'(j)
\]
We have $n > 1$.

\begin{lem}\label{lem:IV_32_1}
	Assume $\ell$ does not divide $n$, and let $I_{v, \ell}$ be the inertia
	subgroup of $\widetilde{G}_\ell$ corresponding to some extension of $v$
	to $\algcl K$.  Then $I_{v, \ell}$ contains a transvection, i.e.\ an
	element whose matrix form is $
	\begin{psmallmatrix}
		1 & 1 \\
		0 & 1
	\end{psmallmatrix}
	$ for a suitable $\F_\ell$-basis of $E_\ell$.
\end{lem}
This is true for the curve $E_q$ over $K'$, cf.\ Appendix, \ref{sec:IV_A15}.
The result for $E$ follows from the isomorphism $E_{/K'} \cong {E_q}_{/K'}$.

\begin{lem}\label{lem:IV_32_2}
	Let $H$ be a subgroup of $\GL(2, \F_\ell)$ which acts irreducibly on
	$\F_\ell\times\F_\ell$ and which contains a transvection. Then $H$
	contains $\SL(2, \F_\ell)$.
\end{lem}

For any transvection $s \in H$, let $D$ be the unique one dimensional subspace
of $\F_\ell\times\F_\ell$ which is fixed by $s$. If all such lines were the
same, the line so defined would be stable by $H$, and $H$ would not be
irreducible. Hence there are transvections $s, s' \in H$ such that $D_s \ne
D_{s'}$. If we choose a suitable basis $(e,e')$ of $\F_\ell\times\F_\ell$, this
means that the matrix forms of $s$, $s'$ are
\[
	s =
	\begin{pmatrix}
		1 & 1 \\
		0 & 1
	\end{pmatrix}, \qquad s' = 
	\begin{pmatrix}
		1 & 0 \\
		1 & 1
	\end{pmatrix} 
\]
The lemma follows then from the well known fact that these two matrices
generate $\SL(2, \F_\ell)$.

\begin{proof}[ of the theorem]
	Lemma~\ref{lem:IV_32_1} shows that, for almost all $\ell$, $I_{v,
	\ell}$.  and \emph{a fortiori} $\widetilde{G}_\ell$, contains a
	transvection. On the other hand, we know (cf.\ \ref{sec:IV_21}) that
	$\widetilde{G}_\ell$ is irreducible for almost all $\ell$. Applying
	lemma~\ref{lem:IV_32_2} to $\widetilde{G}_\ell$ we then see that
	$\widetilde{G}_\ell$ contains $\SL(E_\ell)$ for almost all $\ell$;
	hence we have (iv).
\end{proof}

\begin{obs}
	It seems likely that the condition ``$j$ is not integral'' can be
	replaced by the weaker one ``$E$ has no complex multiplication.''
	$\to$ [yes: see \cite{76}.]
\end{obs}

\subsection{Numerical example}
\label{sec:IV_33}
\todo[section]{Belen.}

\subsection{Proof of the main lemma of 3.1}
\label{sec:IV_34}
\todo[section]{José.}

% \section{Local results}

% \subsection{The case $v(j) < 0$}
% \label{sec:IV_A1}
% \subsection{The elliptic curves of Tate}
% \label{sec:IV_A11}
% \subsection{An exact sequence}
% \label{sec:IV_A12}
% \subsection{Determination of gl and il}
% \label{sec:IV_A13}
% \subsection{Application to isogenies}
% \label{sec:IV_A14}
% \subsection{Existence of transvections in the inertia group}
% \label{sec:IV_A15}
% \subsection{The case v(j) > 0}
% \label{sec:IV_A2}
% \subsection{The case l = p}
% \label{sec:IV_A21}
% \subsection{The case l != p with good reduction of height 2}
% \label{sec:IV_A22}
% \subsection{Auxiliary results on abelian varieties}
% \label{sec:IV_A23}
% \subsection{The case l = p with good reduction of height 1}
% \label{sec:IV_A24}
